{# ============================================================================
   ADMIN LISTA - Panel de gestión de zapatillas
   ============================================================================
   Tabla administrativa con todas las zapatillas + acciones CRUD.

   CONTROLLER: AdminController → GET /admin/zapatillas
   VARIABLES:
   - page: Page<ZapatillaResponseDto> (paginación de Spring Data)
   - marca: String filtro actual de marca (puede ser null)
   - tipo: String filtro actual de tipo (puede ser null)

   CONCEPTOS:
   - Los botones Editar/Borrar usan las rutas del AdminController
   - El formulario de filtro envía GET (no POST) porque no modifica datos
   - El modal de borrado usa POST con CSRF (modificación = POST)
   ============================================================================ #}

{% extends "fragments/layout" %}

{% block title %}Admin - Zapatillas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-shield-lock"></i> Gestión de Zapatillas</h1>
    <a href="/admin/zapatillas/new" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Nueva Zapatilla
    </a>
</div>

{# ---- FILTROS DE BÚSQUEDA ---- #}
{# Este formulario usa method="get" porque no modifica datos,
   solo filtra la vista. Los parámetros van en la URL como query string. #}
<div class="card mb-4">
    <div class="card-body">
        <form method="get" action="/admin/zapatillas" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="marca" class="form-label">Marca</label>
                <input type="text" class="form-control" id="marca" name="marca"
                       value="{{ marca | default('') }}" placeholder="Filtrar por marca...">
            </div>
            <div class="col-md-4">
                <label for="tipo" class="form-label">Tipo</label>
                <select class="form-select" id="tipo" name="tipo">
                    <option value="">Todos los tipos</option>
                    {% for t in ["Running", "Basketball", "Training", "Casual", "Trail"] %}
                        <option value="{{ t }}" {% if tipo == t %}selected{% endif %}>{{ t }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-search"></i> Filtrar
                </button>
                <a href="/admin/zapatillas" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Limpiar
                </a>
            </div>
        </form>
    </div>
</div>

{# ---- TABLA DE ZAPATILLAS ---- #}
{% if page.content is not empty %}
<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Código</th>
                <th>Talla</th>
                <th>Tipo</th>
                <th>Precio</th>
                <th>Stock</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for z in page.content %}
            <tr>
                <td>{{ z.id }}</td>
                <td><strong>{{ z.marca }}</strong></td>
                <td>{{ z.modelo }}</td>
                <td><code>{{ z.codigoProducto }}</code></td>
                <td>{{ z.talla }}</td>
                <td><span class="badge bg-primary">{{ z.tipo }}</span></td>
                <td><strong>{{ z.precio | formatPrice }}</strong></td>
                <td>
                    {# Badges de stock: mismo sistema de colores que el index #}
                    {% if z.stock > 10 %}
                        <span class="badge bg-success">{{ z.stock }}</span>
                    {% elseif z.stock > 0 %}
                        <span class="badge bg-warning text-dark">{{ z.stock }}</span>
                    {% else %}
                        <span class="badge bg-danger">0</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    {# Grupo de botones de acción #}
                    <div class="btn-group btn-group-sm">
                        <a href="/admin/zapatillas/{{ z.id }}" class="btn btn-outline-info"
                           title="Ver detalle">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="/admin/zapatillas/{{ z.id }}/edit" class="btn btn-outline-warning"
                           title="Editar">
                            <i class="bi bi-pencil"></i>
                        </a>
                        {# Botón que abre el modal de confirmación de borrado #}
                        <button type="button" class="btn btn-outline-danger"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal{{ z.id }}"
                                title="Eliminar">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>

                    {# Modal de confirmación para ESTA zapatilla #}
                    {# Cada fila tiene su propio modal con ID único (deleteModal1, deleteModal2...) #}
                    <div class="modal fade" id="deleteModal{{ z.id }}" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title">
                                        <i class="bi bi-exclamation-triangle"></i> Confirmar eliminación
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white"
                                            data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <p>¿Estás seguro de que quieres eliminar esta zapatilla?</p>
                                    <ul class="list-unstyled">
                                        <li><strong>{{ z.marca }} {{ z.modelo }}</strong></li>
                                        <li>Código: <code>{{ z.codigoProducto }}</code></li>
                                        <li>Precio: {{ z.precio | formatPrice }}</li>
                                    </ul>
                                    <p class="text-danger mb-0">
                                        <i class="bi bi-exclamation-circle"></i>
                                        Esta acción no se puede deshacer.
                                    </p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Cancelar</button>
                                    {# El borrado es un POST con token CSRF #}
                                    <form action="/admin/zapatillas/{{ z.id }}/delete" method="post"
                                          class="d-inline">
                                        <input type="hidden" name="{{ csrfParamName }}"
                                               value="{{ csrfToken }}">
                                        <button type="submit" class="btn btn-danger">
                                            <i class="bi bi-trash"></i> Eliminar
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# Paginación reutilizable #}
{% include "fragments/pager" %}

{% else %}
    <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-info-circle fs-1"></i>
        <h4 class="mt-3">No hay zapatillas</h4>
        <p class="mb-0">No se encontraron zapatillas con los filtros aplicados.</p>
        <a href="/admin/zapatillas/new" class="btn btn-success mt-3">
            <i class="bi bi-plus-circle"></i> Crear primera zapatilla
        </a>
    </div>
{% endif %}
{% endblock %}
